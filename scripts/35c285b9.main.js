$(document).ready(function(){$(".button-collapse").sideNav({closeOnClick:!0})}),Array.prototype.shuffle=function(){var a,b,c=this.length;if(0==c)return this;for(;--c;)a=Math.floor(Math.random()*(c+1)),b=this[c],this[c]=this[a],this[a]=b;return this};var copyText=function(a){console.log(a),prompt("Copy to clipboard: Ctrl+C, Enter",a)};"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.clipboard&&cordova.plugins.clipboard.copy&&(copyText=cordova.plugins.clipboard.copy),angular.module("ninja.shout.lynx.LynxPics",["firebase","ngRoute"]).config(["$routeProvider",function(a){a.when("/feed",{templateUrl:"views/feed.html",controller:"FeedController"}).when("/elo",{templateUrl:"views/elo.html",controller:"EloController"}).when("/rankings",{templateUrl:"views/rankings.html",controller:"RankingController"}).when("/feedback",{templateUrl:"views/feedback.html",controller:"FeedbackController"}).when("/about",{templateUrl:"views/about.html"}).when("/new",{templateUrl:"views/new.html",controller:"NewController"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsController"}).otherwise({redirectTo:"/elo"})}]).constant("IMAGE_PATTERN",".+\\.(jpe?g|gif|png)$").constant("IMAGE_COUNT",2).constant("LOCAL_STORAGE_PREFIX","ninja.shout.lynx.settings").service("URL",function(){this.FIREBASE_BASE="https://eakjb-shout-ninja2.firebaseio.com",this.URL_LYNX=this.FIREBASE_BASE+"/lynx/categories/forum"}).factory("API",["$q","$rootScope","$window","$firebaseArray","UTIL","IMAGE_PATTERN","IMAGE_COUNT","URL","LOCAL_STORAGE_PREFIX",function(a,b,c,d,e,f,g,h,i){var j={};b.$watch(function(){return c.localStorage.getItem(i+".filterLevel")||"safe"},function(a){j.filterLevel=a}),b.$watch(function(){return"true"===c.localStorage.getItem(i+".showBlockedPosts")},function(a){j.showBlockedPosts=a}),b.$watch(function(){return"true"===c.localStorage.getItem(i+".invertFilter")},function(a){j.invertFilter=a}),console.log(c.localStorage.getItem(i+".showHelpMessages")),(void 0===c.localStorage.getItem(i+".showHelpMessages")||null===c.localStorage.getItem(i+".showHelpMessages"))&&c.localStorage.setItem(i+".showHelpMessages",!0),b.$watch(function(){return"true"===c.localStorage.getItem(i+".showHelpMessages")},function(a){j.showHelpMessages=a}),j.hideHelpMessages=function(){c.localStorage.setItem(i+".showHelpMessages",!1)},j.filterPost=function(a){return"safe"===j.filterLevel?(a.flags||0)<1:"filtered"===j.filterLevel?(a.flags||0)<=(a.unflags||0):!0},j.shouldShowPost=function(a){var b=j.filterPost(a);return j.invertFilter?!b:b};var k=new RegExp(f);return j.ref=new Firebase(h.URL_LYNX),j.lynx=d(j.ref),j.topRatedRaw=d(j.ref.orderByChild("ranking").limitToLast(25)),j.topRated=[],j.topRatedRaw.$loaded(function(){angular.forEach(j.topRatedRaw,function(a){j.topRated.unshift(a)})}),j.allPosts=[],j.allPostsIndex=0,j.posts=[],j.loaded=!1,j.lynx.$watch(function(a){if("child_added"===a.event){var b=j.lynx.$getRecord(a.key);k.test(b.url)&&j.allPosts.push(b)}}),j.lynx.$loaded(function(){j.allPosts.shuffle(),j.validateAndAddImage=function(){var a=j.allPosts[++j.allPostsIndex];return a?(e.isImage(a.url).then(function(b){if(b)j.posts.push(a);else if(j.allPostsIndex<j.allPosts.length-1)return j.validateAndAddImage()}),!0):!1},j.getRandomImage=function(){var b=j.allPosts[Math.floor(Math.random()*j.allPosts.length)];if(!b)return!1;var c=a.defer();return e.isImage(b.url).then(function(a){a?c.resolve(b):j.getRandomImage().then(function(a){c.resolve(a)},function(a){c.reject(a)})}),c.promise};for(var b=0;g>b&&j.allPostsIndex<j.allPosts.length;b++)setTimeout(j.validateAndAddImage,0);j.loaded=!0}),j.applyElo=function(a,b){var c=400,d=32,e=d,f=d,g=1400,h=a.ranking||g,i=b.ranking||g,k=1,l=0,m=1/(1+Math.pow(10,(i-h)/c)),n=1/(1+Math.pow(10,(h-i)/c)),o=h+e*(k-m),p=i+f*(l-n);a.ranking=o,b.ranking=p,j.lynx.$save(a),j.lynx.$save(b)},j}]).service("UTIL",["$q",function(a){this.isImage=function(b){var c=a.defer(),d=new Image;return d.onerror=function(){c.resolve(!1)},d.onload=function(){c.resolve(!0)},d.src=b,c.promise}}]).controller("NavController",["$scope","$location",function(a,b){a.location=b}]).controller("FeedController",["$scope","$route","API",function(a,b,c){a.API=c,a.copyText=copyText,c.lynx.$loaded(function(){jQuery(function(a){var d=function(d,e){if("/feed"==b.current.originalPath){var f=a(d),g=function(){if(f.scrollTop()+f.innerHeight()+1e3>=document.getElementById(e).scrollHeight){var a=c.validateAndAddImage();a&&setTimeout(g,50)}};g()}};a("#scrollable-area").on("scroll",function(){d("#scrollable-area","post-scrollable-area")}),d("#scrollable-area","post-scrollable-area")})})}]).controller("EloController",["$q","$scope","API",function(a,b,c){b.API=c,b.copyText=copyText,b.loading=!0,b.initPosts=function(){b.loading=!0,b.posts=[];var c=[b.API.getRandomImage(),b.API.getRandomImage()];c.forEach(function(a){a.then(function(a){b.posts.push(a)})});var d=function(){console.log("validating...");for(var c=!0,e=[],f=0;f<b.posts.length;f++)if(!b.API.shouldShowPost(b.posts[f])){console.log("invalid",f),c=!1;var g=b.API.getRandomImage(),h=f;g.then(function(a){b.posts[h]=a}),e.push(g)}return e.length>0?void a.all(e).then(function(){d()}):(b.posts[0]===b.posts[1]&&(b.API.getRandomImage().then(function(a){b.posts[1]=a,d()}),c=!1),void(c&&(b.loading=!1)))};a.all(c).then(d)},b.API.lynx.$loaded(function(){b.initPosts()}),b.selectWinner=function(a){angular.forEach(b.posts,function(c){c!==a&&b.API.applyElo(a,c)}),b.initPosts()}}]).controller("RankingController",["$scope","API",function(a,b){a.API=b,a.posts=a.API.topRated}]).controller("PostController",["$rootScope","$scope","API",function(a,b,c){b.voteClicked=!1,b.flagClicked=!1,b.votePost=function(d){b.voteClicked=!0,d.submissions||(d.submissions=1),d.submissions++,c.lynx.$save(d),setTimeout(function(){a.$apply(function(){b.voteClicked=!1})},300)},b.flagPost=function(d){b.flagClicked=!0,d.flags||(d.flags=0),d.unflags||(d.unflags=0),setTimeout(function(){a.$apply(function(){b.flagClicked=!1,d.flags>d.unflags?d.unflags++:d.flags++,c.lynx.$save(d)})},300)},b.enlarge=function(a){$("#image-modal").openModal()}}]).controller("FeedbackController",["$scope","$rootScope",function(a,b){a.data={},a.sent=!1,a.submitForm=function(){$.ajax({url:"//formspree.io/info@shout.ninja",method:"POST",data:a.data,dataType:"json"}).success(function(){b.$apply(function(){a.sent=!0}),Materialize.toast("Feedback Sent.",1e3)}).error(function(){Materialize.toast("Error Submitting Feedback.",1e3)})}}]).controller("SettingsController",["$scope","$window","LOCAL_STORAGE_PREFIX",function(a,b,c){a.filterLevel=b.localStorage.getItem(c+".filterLevel")||"safe",a.showBlockedPosts="true"===b.localStorage.getItem(c+".showBlockedPosts"),a.invertFilter="true"===b.localStorage.getItem(c+".invertFilter"),a.showHelpMessages="true"===b.localStorage.getItem(c+".showHelpMessages"),a.settingsChanged=function(){b.localStorage.setItem(c+".filterLevel",a.filterLevel),b.localStorage.setItem(c+".showBlockedPosts",a.showBlockedPosts),b.localStorage.setItem(c+".invertFilter",a.invertFilter),b.localStorage.setItem(c+".showHelpMessages",a.showHelpMessages),a.updateUI()},a.updateUI=function(){var b=90;a.invertFilter?b=0:("unfiltered"===a.filterLevel?b=30:"filtered"===a.filterLevel&&(b=60),a.showBlockedPosts||(b+=10)),a.filterLevelProgressBarStyle={width:b+"%"}},a.updateUI()}]).controller("NewController",["$scope","URL","$firebaseArray",function(a,b,c){var d=new Firebase(b.URL_LYNX),e=c(d);this.allowedPrefixes=["http://","https://"],a.isValid=function(a){var b=!1;return angular.forEach(this.allowedPrefixes,function(c){0==a.indexOf(c)&&(b=!0)}),b},a.validate=function(){var b=[];angular.forEach(e,function(c){var d=c.url;"/"==d.substr(-1)&&(d=d.substr(0,d.length-1)),b.indexOf(d)>0||!a.isValid(d)?e.$remove(c):b.push(d)},this)},a.submit=function(b){for(var c=0;c<e.length;c++)if(e[c].url==b)return this.validate(),!1;return e.$add({url:b,timestamp:Firebase.ServerValue.TIMESTAMP}).then(function(b){Materialize.toast("Submitted!",3e3),console.log("good"),a.url=""}),!0}}]).controller("LoadingController",["$scope",function(a){a.getGifPath=function(){return"images/loading_gifs/gif"+Math.floor(3*Math.random()+1)+".gif"}}]);